<div class="py-10 px-4 md:px-20 bg-gray-50 min-h-screen">
    <h1 class="text-3xl font-bold mb-8 text-blue-700">My Orders</h1>
    <div class="space-y-8">
        @for(order of orders; track order._id){
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col lg:flex-row lg:justify-between gap-6">
                    <div class="flex-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <span class="text-gray-500 text-sm">Order ID:</span>
                                <p class="font-semibold text-blue-600 break-all">{{order._id}}</p>
                            </div>
                            <div>
                                <span class="text-gray-500 text-sm">Date:</span>
                                <p class="font-semibold">{{order.date | date:'mediumDate'}}</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h6 class="font-semibold text-gray-700 mb-2">Customer Address:</h6>
                            <div class="text-gray-600 text-sm space-y-1">
                                <p>{{order.address.address1}}</p>
                                <p>{{order.address.address2}}</p>
                                <p>{{order.address.city}}, {{order.address.pincode}}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-3">
                            <span class="text-gray-500 text-sm">Order Status:</span>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold"
                                [class]="getStatusColorClass(order.status)"
                            >{{order.status || 'Unknown'}}<ng-container *ngIf="order.status === 'Cancelled' && order.cancellationReason"> â€” <span class="text-red-500 font-semibold">Reason: {{order.cancellationReason}}</span></ng-container></span>
                        </div>
                    </div>
                    
                    <div class="lg:w-96 flex flex-col gap-4">
                        <div class="flex flex-col gap-3">
                            <span class="text-sm font-medium text-gray-700">Update Status:</span>
                            <mat-button-toggle-group 
                                [value]="order.status" 
                                name="fontstyle" 
                                aria-label="Font Style" 
                                (change)="statusChanged($event,order)"
                                class="status-toggle-group"
                                [disabled]="order.status === 'Cancelled'"
                            >
                                <mat-button-toggle value="Dispatched" class="status-toggle">Dispatched</mat-button-toggle>
                                <mat-button-toggle value="Shipped" class="status-toggle">Shipped</mat-button-toggle>
                                <mat-button-toggle value="Delivered" class="status-toggle">Delivered</mat-button-toggle>
                            </mat-button-toggle-group>
                        </div>

                        @if(canCancelOrder(order)) {
                            <div class="flex flex-col gap-2">
                                <button 
                                    mat-raised-button 
                                    color="warn" 
                                    (click)="cancelOrder(order)"
                                    class="cancel-order-btn w-full flex items-center justify-center gap-2"
                                    [disabled]="order.status === 'Cancelled' || order.status === 'Delivered' || order.status === 'Shipped' || order.status === 'Dispatched'"
                                >
                                    <mat-icon>cancel</mat-icon>
                                    Cancel Order
                                </button>
                                <p class="text-xs text-gray-500 text-center">
                                    Cancel if product is not available or cannot be fulfilled
                                </p>
                            </div>
                        } @else {
                            <div class="text-center">
                                <p class="text-xs text-gray-400">
                                    @if(order.status === 'Cancelled') {
                                        Order has been cancelled
                                    } @else if(order.status === 'Delivered') {
                                        Order cannot be cancelled (already delivered)
                                    } @else {
                                        Cancellation not available
                                    }
                                </p>
                            </div>
                        }
                    </div>
                </div>
                
                <!-- Order Items Section -->
                <div class="mt-6 border-t pt-6">
                    <h6 class="font-semibold text-gray-700 mb-4">Order Items:</h6>
                    <div class="space-y-4">
                        @for(item of order.items; track $index){
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-4">
                                    <img [src]="item.product.images[0]" alt="Product" class="w-16 h-16 object-cover rounded-lg" />
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-800">{{item.product.name}}</h4>
                                        <p class="text-gray-500 text-sm mb-2">{{item.product.shotDescription}}</p>
                                        <div class="flex gap-2 items-baseline">
                                            <span class="text-gray-400 line-through">${{ item.product.Price }}</span>
                                            <span class="text-xs font-bold text-red-500">{{ item.product.discount }}% OFF</span>
                                            <span class="text-green-600 font-bold">${{ sellingPrice(item.product) }}</span>
                                        </div>
                                        <div class="text-gray-700 text-sm mt-1">
                                            Total: <span class="font-bold">${{ sellingPrice(item.product) * item.quantity }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-500 text-sm">Qty:</span>
                                    <span class="font-semibold bg-blue-100 text-blue-700 px-2 py-1 rounded">{{item.quantity}}</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>